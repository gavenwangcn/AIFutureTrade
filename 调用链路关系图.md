# AIäº¤æ˜“ç³»ç»Ÿå®Œæ•´è°ƒç”¨é“¾è·¯å…³ç³»å›¾

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿå…¥å£](#ç³»ç»Ÿå…¥å£)
2. [ä¹°å…¥æµç¨‹è°ƒç”¨é“¾](#ä¹°å…¥æµç¨‹è°ƒç”¨é“¾)
3. [å–å‡ºæµç¨‹è°ƒç”¨é“¾](#å–å‡ºæµç¨‹è°ƒç”¨é“¾)
4. [äº¤æ˜“æ‰§è¡Œè°ƒç”¨é“¾](#äº¤æ˜“æ‰§è¡Œè°ƒç”¨é“¾)
5. [SDKè°ƒç”¨é“¾è·¯](#sdkè°ƒç”¨é“¾è·¯)

---

## ğŸš€ ç³»ç»Ÿå…¥å£

### 1. è‡ªåŠ¨äº¤æ˜“å¾ªç¯å…¥å£
```
backend/app.py
â”œâ”€â”€ trading_loop()                    # ä¸»äº¤æ˜“å¾ªç¯ï¼ˆåå°çº¿ç¨‹ï¼‰
    â””â”€â”€ for model_id, engine in trading_engines.items():
        â””â”€â”€ engine.execute_trading_cycle()  # æ‰§è¡Œäº¤æ˜“å‘¨æœŸ
```

### 2. æ‰‹åŠ¨æ‰§è¡Œå…¥å£
```
backend/app.py
â”œâ”€â”€ /api/models/<model_id>/execute (POST)
    â””â”€â”€ execute_trading(model_id)
        â””â”€â”€ engine.execute_trading_cycle()  # æ‰§è¡Œäº¤æ˜“å‘¨æœŸ
```

---

## ğŸ“ˆ ä¹°å…¥æµç¨‹è°ƒç”¨é“¾

### å®Œæ•´è°ƒç”¨é“¾è·¯
```
execute_trading_cycle()
â”œâ”€â”€ _run_buy_service() [åå°çº¿ç¨‹]
    â””â”€â”€ execute_buy_cycle() [å‘¨æœŸæ€§æ‰§è¡Œ]
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ1] åˆå§‹åŒ–æ•°æ®å‡†å¤‡
        â”‚   â”œâ”€â”€ db.get_model(model_id)                    # è·å–æ¨¡å‹é…ç½®
        â”‚   â”œâ”€â”€ db.get_portfolio(model_id, {})            # è·å–æŒä»“ä¿¡æ¯
        â”‚   â”œâ”€â”€ _build_account_info(portfolio)             # æ„å»ºè´¦æˆ·ä¿¡æ¯
        â”‚   â””â”€â”€ _get_prompt_templates()                    # è·å–æç¤ºè¯æ¨¡æ¿
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ2] ä¹°å…¥å†³ç­–å¤„ç†
        â”‚   â”œâ”€â”€ _select_buy_candidates()                   # é€‰æ‹©ä¹°å…¥å€™é€‰
        â”‚   â”‚   â”œâ”€â”€ æ ¹æ®symbol_sourceè·å–å€™é€‰ï¼š
        â”‚   â”‚   â”‚   â”œâ”€â”€ 'leaderboard' â†’ db.get_leaderboard_from_tickers()
        â”‚   â”‚   â”‚   â””â”€â”€ 'future' â†’ db.get_model_futures()
        â”‚   â”‚   â””â”€â”€ _build_market_state_for_candidates()   # æ„å»ºå¸‚åœºçŠ¶æ€
        â”‚   â”‚       â””â”€â”€ market_data_fetcher.get_prices()   # è·å–ä»·æ ¼
        â”‚   â”‚
        â”‚   â””â”€â”€ _make_batch_buy_decisions()                # åˆ†æ‰¹å¤„ç†ä¹°å…¥å†³ç­–
        â”‚       â””â”€â”€ ThreadPoolExecutor (å¤šçº¿ç¨‹å¹¶å‘)
        â”‚           â””â”€â”€ _process_and_execute_batch()      # å¤„ç†å•ä¸ªæ‰¹æ¬¡
        â”‚               â”‚
        â”‚               â”œâ”€â”€ [æ­¥éª¤1] AIå†³ç­–ç”Ÿæˆ
        â”‚               â”‚   â””â”€â”€ ai_trader.make_buy_decision()
        â”‚               â”‚       â”œâ”€â”€ _build_buy_prompt()    # æ„å»ºä¹°å…¥æç¤ºè¯
        â”‚               â”‚       â”œâ”€â”€ LLM APIè°ƒç”¨            # è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹
        â”‚               â”‚       â””â”€â”€ è§£æJSONå“åº”            # è§£æå†³ç­–ç»“æœ
        â”‚               â”‚
        â”‚               â”œâ”€â”€ [æ­¥éª¤2] è®°å½•AIå¯¹è¯
        â”‚               â”‚   â””â”€â”€ _record_ai_conversation()
        â”‚               â”‚       â””â”€â”€ db.add_conversation()  # ä¿å­˜å¯¹è¯è®°å½•
        â”‚               â”‚
        â”‚               â””â”€â”€ [æ­¥éª¤3] æ‰§è¡Œäº¤æ˜“å†³ç­–
        â”‚                   â””â”€â”€ _execute_decisions()
        â”‚                       â””â”€â”€ _execute_buy()         # æ‰§è¡Œä¹°å…¥æ“ä½œ
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ3] è®°å½•è´¦æˆ·ä»·å€¼å¿«ç…§
        â”‚   â””â”€â”€ db.record_account_value()
        â”‚
        â””â”€â”€ [é˜¶æ®µ4] åŒæ­¥model_futuresè¡¨
            â””â”€â”€ db.sync_model_futures_from_portfolio()
```

### å…³é”®æ–¹æ³•è¯´æ˜

#### `_select_buy_candidates()`
- **åŠŸèƒ½**: æ ¹æ®æ¨¡å‹çš„symbol_sourceé…ç½®é€‰æ‹©ä¹°å…¥å€™é€‰
- **æ•°æ®æº**:
  - `leaderboard`: ä»24_market_tickersè¡¨è·å–æ¶¨è·Œå¹…æ¦œ
  - `future`: ä»model_futuresè¡¨è·å–é…ç½®çš„åˆçº¦
- **è¾“å‡º**: å€™é€‰åˆ—è¡¨ + å¸‚åœºçŠ¶æ€å­—å…¸

#### `_make_batch_buy_decisions()`
- **åŠŸèƒ½**: å°†å€™é€‰åˆ†æ‰¹ï¼Œå¤šçº¿ç¨‹å¹¶å‘å¤„ç†
- **æ‰¹æ¬¡å¤§å°**: ç”±`batch_size`é…ç½®å†³å®š
- **å¹¶å‘**: ä½¿ç”¨ThreadPoolExecutorå®ç°å¤šçº¿ç¨‹

#### `ai_trader.make_buy_decision()`
- **åŠŸèƒ½**: è°ƒç”¨LLMç”Ÿæˆä¹°å…¥å†³ç­–
- **è¾“å…¥**: å€™é€‰åˆ—è¡¨ã€æŒä»“ä¿¡æ¯ã€è´¦æˆ·ä¿¡æ¯ã€çº¦æŸæ¡ä»¶ã€æç¤ºè¯
- **è¾“å‡º**: å†³ç­–å­—å…¸ï¼ˆåŒ…å«signal: buy_to_enter/sell_to_enter/holdï¼‰

---

## ğŸ“‰ å–å‡ºæµç¨‹è°ƒç”¨é“¾

### å®Œæ•´è°ƒç”¨é“¾è·¯
```
execute_trading_cycle()
â”œâ”€â”€ _run_sell_service() [åå°çº¿ç¨‹]
    â””â”€â”€ execute_sell_cycle() [å‘¨æœŸæ€§æ‰§è¡Œ]
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ1] åˆå§‹åŒ–æ•°æ®å‡†å¤‡
        â”‚   â”œâ”€â”€ db.get_model(model_id)                    # è·å–æ¨¡å‹é…ç½®
        â”‚   â”œâ”€â”€ db.get_portfolio(model_id, {})            # è·å–æŒä»“ä¿¡æ¯
        â”‚   â”œâ”€â”€ _build_account_info(portfolio)             # æ„å»ºè´¦æˆ·ä¿¡æ¯
        â”‚   â””â”€â”€ _get_prompt_templates()                    # è·å–æç¤ºè¯æ¨¡æ¿
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ2] å–å‡ºå†³ç­–å¤„ç†
        â”‚   â”œâ”€â”€ _get_held_symbols()                        # è·å–æŒä»“symbolåˆ—è¡¨
        â”‚   â”‚   â””â”€â”€ db.get_model_held_symbols()           # ä»portfoliosè¡¨æŸ¥è¯¢
        â”‚   â”‚
        â”‚   â”œâ”€â”€ _get_market_state()                        # è·å–å¸‚åœºçŠ¶æ€
        â”‚   â”‚   â””â”€â”€ market_data_fetcher.get_prices()       # è·å–ä»·æ ¼
        â”‚   â”‚
        â”‚   â””â”€â”€ åˆ†æ‰¹å¤„ç†æŒä»“ï¼ˆå¤šçº¿ç¨‹å¹¶å‘ï¼‰
        â”‚       â””â”€â”€ ThreadPoolExecutor
        â”‚           â””â”€â”€ _process_and_execute_sell_batch()  # å¤„ç†å•ä¸ªæ‰¹æ¬¡
        â”‚               â”‚
        â”‚               â”œâ”€â”€ [æ­¥éª¤1] AIå†³ç­–ç”Ÿæˆ
        â”‚               â”‚   â””â”€â”€ ai_trader.make_sell_decision()
        â”‚               â”‚       â”œâ”€â”€ _build_sell_prompt()   # æ„å»ºå–å‡ºæç¤ºè¯
        â”‚               â”‚       â”œâ”€â”€ LLM APIè°ƒç”¨            # è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹
        â”‚               â”‚       â””â”€â”€ è§£æJSONå“åº”            # è§£æå†³ç­–ç»“æœ
        â”‚               â”‚
        â”‚               â”œâ”€â”€ [æ­¥éª¤2] è®°å½•AIå¯¹è¯
        â”‚               â”‚   â””â”€â”€ _record_ai_conversation()
        â”‚               â”‚       â””â”€â”€ db.add_conversation() # ä¿å­˜å¯¹è¯è®°å½•
        â”‚               â”‚
        â”‚               â””â”€â”€ [æ­¥éª¤3] æ‰§è¡Œäº¤æ˜“å†³ç­–
        â”‚                   â””â”€â”€ _execute_decisions()
        â”‚                       â”œâ”€â”€ _execute_close()       # å¹³ä»“
        â”‚                       â”œâ”€â”€ _execute_stop_loss()    # æ­¢æŸ
        â”‚                       â””â”€â”€ _execute_take_profit() # æ­¢ç›ˆ
        â”‚
        â”œâ”€â”€ [é˜¶æ®µ3] è®°å½•è´¦æˆ·ä»·å€¼å¿«ç…§
        â”‚   â””â”€â”€ db.record_account_value()
        â”‚
        â””â”€â”€ [é˜¶æ®µ4] åŒæ­¥model_futuresè¡¨
            â””â”€â”€ db.sync_model_futures_from_portfolio()
```

### å…³é”®æ–¹æ³•è¯´æ˜

#### `_get_held_symbols()`
- **åŠŸèƒ½**: è·å–å½“å‰æŒä»“çš„symbolåˆ—è¡¨
- **æ•°æ®æº**: portfoliosè¡¨ï¼ˆposition_amt != 0çš„è®°å½•ï¼‰

#### `ai_trader.make_sell_decision()`
- **åŠŸèƒ½**: è°ƒç”¨LLMç”Ÿæˆå–å‡ºå†³ç­–
- **è¾“å…¥**: æŒä»“åˆ—è¡¨ã€å¸‚åœºçŠ¶æ€ã€è´¦æˆ·ä¿¡æ¯ã€æç¤ºè¯
- **è¾“å‡º**: å†³ç­–å­—å…¸ï¼ˆåŒ…å«signal: close_position/stop_loss/take_profit/holdï¼‰

---

## âš™ï¸ äº¤æ˜“æ‰§è¡Œè°ƒç”¨é“¾

### å†³ç­–åˆ†å‘
```
_execute_decisions(decisions, market_state, portfolio)
â”‚
â”œâ”€â”€ with trading_lock:  # è·å–äº¤æ˜“é”ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ for symbol, decision in decisions.items():
â”‚       â””â”€â”€ signal = decision.get('signal', '').lower()
â”‚           â”‚
â”‚           â”œâ”€â”€ signal == 'buy_to_enter' / 'sell_to_enter'
â”‚           â”‚   â””â”€â”€ _execute_buy(symbol, decision, ...)
â”‚           â”‚
â”‚           â”œâ”€â”€ signal == 'close_position'
â”‚           â”‚   â””â”€â”€ _execute_close(symbol, decision, ...)
â”‚           â”‚
â”‚           â”œâ”€â”€ signal == 'stop_loss'
â”‚           â”‚   â””â”€â”€ _execute_stop_loss(symbol, decision, ...)
â”‚           â”‚
â”‚           â”œâ”€â”€ signal == 'take_profit'
â”‚           â”‚   â””â”€â”€ _execute_take_profit(symbol, decision, ...)
â”‚           â”‚
â”‚           â””â”€â”€ signal == 'hold'
â”‚               â””â”€â”€ ä¿æŒè§‚æœ›ï¼Œä¸æ‰§è¡Œæ“ä½œ
```

---

## ğŸ”Œ SDKè°ƒç”¨é“¾è·¯

### ä¹°å…¥æ“ä½œï¼ˆå¼€ä»“ï¼‰
```
_execute_buy(symbol, decision, market_state, portfolio)
â”‚
â”œâ”€â”€ [1] å‚æ•°å‡†å¤‡
â”‚   â”œâ”€â”€ è§£ædecisionä¸­çš„quantityã€leverageã€callback_rate
â”‚   â”œâ”€â”€ ä»market_stateè·å–å½“å‰ä»·æ ¼
â”‚   â”œâ”€â”€ æ ¹æ®signalç¡®å®šposition_side:
â”‚   â”‚   â”œâ”€â”€ 'buy_to_enter' â†’ position_side = 'LONG'
â”‚   â”‚   â””â”€â”€ 'sell_to_enter' â†’ position_side = 'SHORT'
â”‚   â””â”€â”€ è®¡ç®—æ‰€éœ€ä¿è¯é‡‘å’Œæ‰‹ç»­è´¹
â”‚
â”œâ”€â”€ [2] åˆ›å»ºBinanceè®¢å•å®¢æˆ·ç«¯
â”‚   â””â”€â”€ _create_binance_order_client()
â”‚       â”œâ”€â”€ db.get_model(model_id)              # è·å–æ¨¡å‹é…ç½®
â”‚       â”œâ”€â”€ éªŒè¯api_keyå’Œapi_secret            # æ£€æŸ¥APIå¯†é’¥
â”‚       â””â”€â”€ BinanceFuturesOrderClient()        # åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹
â”‚           â””â”€â”€ å¦‚æœå¤±è´¥ â†’ è¿”å›Noneï¼Œè·³è¿‡SDKè°ƒç”¨
â”‚
â”œâ”€â”€ [3] è°ƒç”¨SDKæ‰§è¡Œäº¤æ˜“
â”‚   â””â”€â”€ binance_client.market_trade()
â”‚       â”œâ”€â”€ _execute_order()                    # ç»Ÿä¸€è®¢å•æ‰§è¡Œæ–¹æ³•
â”‚       â”‚   â”œâ”€â”€ æ ¹æ®BINANCE_TRADE_MODEé€‰æ‹©ï¼š
â”‚       â”‚   â”‚   â”œâ”€â”€ 'test' â†’ _rest.test_order()    # æµ‹è¯•æ¥å£
â”‚       â”‚   â”‚   â””â”€â”€ 'real' â†’ _rest.new_order()     # çœŸå®äº¤æ˜“æ¥å£
â”‚       â”‚   â””â”€â”€ db.add_binance_trade_log()      # è®°å½•SDKè°ƒç”¨æ—¥å¿—
â”‚       â””â”€â”€ è¿”å›è®¢å•å“åº”
â”‚
â”œâ”€â”€ [4] æ›´æ–°æ•°æ®åº“æŒä»“
â”‚   â””â”€â”€ db.update_position()
â”‚       â””â”€â”€ æ›´æ–°portfoliosè¡¨
â”‚
â””â”€â”€ [5] è®°å½•äº¤æ˜“åˆ°tradesè¡¨
    â””â”€â”€ db.insert_rows(trades_table, ...)
        â””â”€â”€ è®°å½•äº¤æ˜“è¯¦æƒ…ï¼ˆsignal, quantity, price, feeç­‰ï¼‰
```

### å¹³ä»“æ“ä½œ
```
_execute_close(symbol, decision, market_state, portfolio)
â”‚
â”œâ”€â”€ [1] å‚æ•°å‡†å¤‡
â”‚   â”œâ”€â”€ ä»portfolioè·å–æŒä»“ä¿¡æ¯
â”‚   â”œâ”€â”€ ä»market_stateè·å–å½“å‰ä»·æ ¼
â”‚   â”œâ”€â”€ è®¡ç®—ç›ˆäºï¼ˆæ¯›ç›ˆäºã€æ‰‹ç»­è´¹ã€å‡€ç›ˆäºï¼‰
â”‚   â””â”€â”€ ç¡®å®šå¹³ä»“æ–¹å‘ï¼ˆLONGç”¨SELLï¼ŒSHORTç”¨BUYï¼‰
â”‚
â”œâ”€â”€ [2] åˆ›å»ºBinanceè®¢å•å®¢æˆ·ç«¯
â”‚   â””â”€â”€ _create_binance_order_client()
â”‚
â”œâ”€â”€ [3] è°ƒç”¨SDKæ‰§è¡Œäº¤æ˜“
â”‚   â””â”€â”€ binance_client.close_position_trade()
â”‚       â”œâ”€â”€ order_type='STOP_MARKET'
â”‚       â”œâ”€â”€ stop_price=current_price (ç«‹å³è§¦å‘)
â”‚       â””â”€â”€ _execute_order()
â”‚
â”œâ”€â”€ [4] æ›´æ–°æ•°æ®åº“æŒä»“
â”‚   â””â”€â”€ db.close_position()
â”‚       â””â”€â”€ å°†position_amtè®¾ä¸º0
â”‚
â””â”€â”€ [5] è®°å½•äº¤æ˜“åˆ°tradesè¡¨
    â””â”€â”€ db.insert_rows(trades_table, ...)
```

### æ­¢æŸæ“ä½œ
```
_execute_stop_loss(symbol, decision, market_state, portfolio)
â”‚
â”œâ”€â”€ [1] å‚æ•°å‡†å¤‡
â”‚   â”œâ”€â”€ ä»decisionè·å–stop_price
â”‚   â””â”€â”€ ç¡®å®šæ­¢æŸæ–¹å‘
â”‚
â”œâ”€â”€ [2] åˆ›å»ºBinanceè®¢å•å®¢æˆ·ç«¯
â”‚   â””â”€â”€ _create_binance_order_client()
â”‚
â”œâ”€â”€ [3] è°ƒç”¨SDKæ‰§è¡Œäº¤æ˜“
â”‚   â””â”€â”€ binance_client.stop_loss_trade()
â”‚       â”œâ”€â”€ order_type='STOP_MARKET'
â”‚       â””â”€â”€ _execute_order()
â”‚
â””â”€â”€ [4] è®°å½•äº¤æ˜“åˆ°tradesè¡¨
    â””â”€â”€ db.insert_rows(trades_table, ...)
```

### æ­¢ç›ˆæ“ä½œ
```
_execute_take_profit(symbol, decision, market_state, portfolio)
â”‚
â”œâ”€â”€ [1] å‚æ•°å‡†å¤‡
â”‚   â”œâ”€â”€ ä»decisionè·å–stop_priceï¼ˆæ­¢ç›ˆä»·æ ¼ï¼‰
â”‚   â””â”€â”€ ç¡®å®šæ­¢ç›ˆæ–¹å‘
â”‚
â”œâ”€â”€ [2] åˆ›å»ºBinanceè®¢å•å®¢æˆ·ç«¯
â”‚   â””â”€â”€ _create_binance_order_client()
â”‚
â”œâ”€â”€ [3] è°ƒç”¨SDKæ‰§è¡Œäº¤æ˜“
â”‚   â””â”€â”€ binance_client.take_profit_trade()
â”‚       â”œâ”€â”€ order_type='TAKE_PROFIT_MARKET'
â”‚       â””â”€â”€ _execute_order()
â”‚
â””â”€â”€ [4] è®°å½•äº¤æ˜“åˆ°tradesè¡¨
    â””â”€â”€ db.insert_rows(trades_table, ...)
```

---

## ğŸ” å…³é”®æ£€æŸ¥ç‚¹

### SDKè°ƒç”¨å¯èƒ½è¢«è·³è¿‡çš„åŸå› 
1. **APIå¯†é’¥æœªé…ç½®**
   - `_create_binance_order_client()` è¿”å› None
   - æ£€æŸ¥ç‚¹: `db.get_model(model_id)` ä¸­çš„ `api_key` å’Œ `api_secret` å­—æ®µ

2. **Modelä¸å­˜åœ¨**
   - `db.get_model(model_id)` è¿”å› None
   - æ£€æŸ¥ç‚¹: modelsè¡¨ä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„model_id

3. **å®¢æˆ·ç«¯åˆ›å»ºå¼‚å¸¸**
   - `BinanceFuturesOrderClient()` åˆå§‹åŒ–å¤±è´¥
   - æ£€æŸ¥ç‚¹: APIå¯†é’¥æ ¼å¼ã€ç½‘ç»œè¿æ¥ç­‰

### æ•°æ®åº“è®°å½•æµç¨‹
å³ä½¿SDKè°ƒç”¨è¢«è·³è¿‡ï¼Œä»¥ä¸‹æ“ä½œä»ä¼šæ‰§è¡Œï¼š
1. âœ… æ›´æ–°portfoliosè¡¨ï¼ˆæŒä»“ä¿¡æ¯ï¼‰
2. âœ… æ’å…¥tradesè¡¨ï¼ˆäº¤æ˜“è®°å½•ï¼‰
3. âŒ SDKæ¥å£è°ƒç”¨ï¼ˆè¢«è·³è¿‡ï¼‰
4. âŒ binance_trade_logsè¡¨ï¼ˆæ— SDKè°ƒç”¨æ—¥å¿—ï¼‰

### æ—¥å¿—æ ‡è®°
å½“SDKè°ƒç”¨è¢«è·³è¿‡æ—¶ï¼Œæ—¥å¿—ä¼šåŒ…å«ï¼š
- `@API@ [Model X] === æ— æ³•åˆ›å»ºBinanceè®¢å•å®¢æˆ·ç«¯ï¼Œè·³è¿‡SDKè°ƒç”¨ ===`
- `TRADE: âš ï¸ SDKè°ƒç”¨è¢«è·³è¿‡ï¼Œä½†äº¤æ˜“è®°å½•ä»å°†ä¿å­˜åˆ°æ•°æ®åº“`
- `TRADE: RECORDED (ä½†SDKæœªæ‰§è¡Œ)`

---

## ğŸ“Š æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  backend/app.py â”‚
â”‚  trading_loop() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TradingEngine           â”‚
â”‚ execute_trading_cycle() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ execute_buy_    â”‚  â”‚ execute_sell_    â”‚
â”‚ cycle()         â”‚  â”‚ cycle()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _make_batch_    â”‚  â”‚ _process_and_   â”‚
â”‚ buy_decisions() â”‚  â”‚ execute_sell_   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ batch()         â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AITrader        â”‚  â”‚ AITrader        â”‚
â”‚ make_buy_       â”‚  â”‚ make_sell_      â”‚
â”‚ decision()      â”‚  â”‚ decision()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚ LLM API Call       â”‚ LLM API Call
         â”‚                    â”‚
         â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _execute_       â”‚  â”‚ _execute_       â”‚
â”‚ decisions()     â”‚  â”‚ decisions()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚                     â”‚          â”‚
         â–¼         â–¼                     â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚_executeâ”‚ â”‚_execute_ â”‚      â”‚_execute_ â”‚ â”‚_execute_ â”‚
    â”‚_buy()  â”‚ â”‚_close()  â”‚      â”‚_stop_    â”‚ â”‚_take_   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚loss()   â”‚ â”‚profit() â”‚
        â”‚           â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚                  â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ _create_binance_      â”‚
            â”‚ order_client()        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ BinanceFutures        â”‚
            â”‚ OrderClient           â”‚
            â”‚ (SDKè°ƒç”¨)             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Binance API           â”‚
            â”‚ (äº¤æ˜“æ‰€æ¥å£)          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ€»ç»“

### å®Œæ•´è°ƒç”¨è·¯å¾„ï¼ˆä»¥ä¹°å…¥ä¸ºä¾‹ï¼‰
```
HTTPè¯·æ±‚/å®šæ—¶ä»»åŠ¡
  â†’ backend/app.py::trading_loop()
    â†’ TradingEngine::execute_trading_cycle()
      â†’ TradingEngine::_run_buy_service() [åå°çº¿ç¨‹]
        â†’ TradingEngine::execute_buy_cycle()
          â†’ TradingEngine::_make_batch_buy_decisions()
            â†’ TradingEngine::_process_and_execute_batch()
              â†’ AITrader::make_buy_decision() [LLMè°ƒç”¨]
                â†’ TradingEngine::_execute_decisions()
                  â†’ TradingEngine::_execute_buy()
                    â†’ TradingEngine::_create_binance_order_client()
                      â†’ BinanceFuturesOrderClient::market_trade()
                        â†’ BinanceFuturesOrderClient::_execute_order()
                          â†’ Binance REST API
```

### å…³é”®æ–‡ä»¶ä½ç½®
- **å…¥å£**: `backend/app.py`
- **äº¤æ˜“å¼•æ“**: `trade/trading_engine.py`
- **AIå†³ç­–**: `trade/ai_trader.py`
- **SDKå®¢æˆ·ç«¯**: `common/binance_futures.py`
- **æ•°æ®åº“æ“ä½œ**: `common/database_basic.py`

---

*æœ€åæ›´æ–°: 2024å¹´*

